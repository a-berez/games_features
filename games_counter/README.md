# Анализ количества игр команд и игроков, игравших на турнире

## Описание
Этот скрипт предназначен для анализа команд с Турнирного сайта сообщества знатоков. Он собирает статистику по командам и игрокам за определенный сезон, используя официальный API Турнирного сайта.

Скрипт анализирует:
- Результаты указанного турнира
- Участие команд в других турнирах заданного сезона
- Участие игроков в турнирах заданного сезона (как в составе своей команды, так и в составе других команд)

На выходе формируются два Excel-файла:
1. Таблица команд с детальной статистикой
2. Таблица игроков с информацией об их участии в турнирах

## Требования
Для работы скрипта необходимы следующие библиотеки Python:
- Python 3.6 или выше
- pandas
- requests
- tqdm
- concurrent.futures (входит в стандартную библиотеку Python 3.6+)

### Установка зависимостей
```bash
pip install pandas requests tqdm
```

## Использование

### Запуск скрипта

Скрипт можно запустить из командной строки:

```bash
python chgk_analysis.py -t <ID_турнира> -s <ID_сезона>
```

Где:
- `-t`, `--tournament` — ID турнира для анализа
- `-s`, `--season` — ID сезона для анализа

Если аргументы не указаны, скрипт запросит их в интерактивном режиме.

Посмотреть ID сезона можно [ниже](#Cписок-сезонов)

### Примеры запуска

Запуск с указанием всех параметров:
```bash
python chgk_analysis.py -t 12100 -s 59
```

Запуск без параметров (интерактивный режим):
```bash
python chgk_analysis.py
```

### Список сезонов

| Сезон | ID сезона |
|-------|-----------|
| 1989/90 | 39 |
| 1990/91 | 27 |
| 1991/92 | 22 |
| 1992/93 | 23 |
| 1993/94 | 24 |
| 1994/95 | 25 |
| 1995/96 | 26 |
| 1996/97 | 17 |
| 1997/98 | 18 |
| 1998/99 | 21 |
| 1999/00 | 5 |
| 2000/01 | 11 |
| 2001/02 | 10 |
| 2002/03 | 1 |
| 2003/04 | 2 |
| 2004/05 | 3 |
| 2005/06 | 4 |
| 2006/07 | 6 |
| 2007/08 | 7 |
| 2008/09 | 8 |
| 2009/10 | 9 |
| 2010/11 | 16 |
| 2011/12 | 37 |
| 2012/13 | 44 |
| 2013/14 | 45 |
| 2014/15 | 48 |
| 2015/16 | 49 |
| 2016/17 | 50 |
| 2017/18 | 51 |
| 2018/19 | 52 |
| 2019/21 | 53 |
| 2021/22 | 56 |
| 2022/23 | 57 |
| 2023/24 | 58 |
| 2024/25 | 59 |
| 2025/26 | 60 |
| 2026/27 | 61 |
| 2027/28 | 62 |
| 2028/29 | 63 |
| 2029/30 | 64 |
| 2030/31 | 65 |
| 2031/32 | 66 |
| 2032/33 | 67 |
| 2033/34 | 68 |

### Результаты работы

Скрипт создает два Excel-файла:

1. `<ID_турнира>_teams.xlsx` — таблица команд со следующими столбцами:
   - `place` — место команды в турнире
   - `teamID` — ID команды
   - `teamName` — название команды
   - `teamTown` — город команды
   - `taken` — количество взятых вопросов
   - `teamGames` — количество турниров, сыгранных командой в указанном сезоне
   - `avgPlayerGames` — среднее количество игр игроков команды за сезон
   - `minPlayerGames` — минимальное количество игр среди игроков команды
   - `maxPlayerGames` — максимальное количество игр среди игроков команды

2. `<ID_турнира>_players.xlsx` — таблица игроков со следующими столбцами:
   - `place` — место команды игрока в турнире
   - `teamID` — ID команды игрока
   - `teamName` — название команды игрока
   - `teamTown` — город команды игрока
   - `taken` — количество взятых вопросов командой
   - `playerID` — ID игрока
   - `playerSurname` — фамилия игрока
   - `playerName` — имя игрока
   - `playerPatronim` — отчество игрока
   - `baseGames` — количество игр в составе указанной команды
   - `otherGames` — количество игр в составе других команд
   - `totalGames` — общее количество игр (baseGames + otherGames)

## Особенности

У скрипта есть несколько особенностей:

1. **Кэширование данных** - все запросы к API кэшируются, чтобы избежать повторных запросов для одних и тех же данных:
   - Кэш информации о турнирах
   - Кэш турниров игроков
   - Кэш турниров команд
   - Кэш принадлежности турниров к сезонам

2. **Параллельная обработка** — использование ThreadPoolExecutor для параллельного выполнения запросов и обработки данных

3. **Пакетная обработка** — группировка запросов в пакеты для более эффективной обработки

4. **Обработка ошибок** — надежная обработка ошибок для продолжения работы даже при проблемах с отдельными запросами

5. **Логирование** — cкрипт создает лог-файл `games_counter_<timestamp>.log` с подробной информацией о ходе выполнения. В лог записываются:
   - Запросы к API
   - Информация о полученных данных
   - Предупреждения и ошибки

## Работа с API

Скрипт использует следующие эндпоинты API Турнирного сайта:

- `/tournaments/{ID}/results` — результаты турнира
- `/tournaments/{ID}` — информация о турнире
- `/players/{ID}/tournaments` — список турниров игрока
- `/teams/{ID}/tournaments` — список турниров команды

Подробная документация по API доступна по адресу: https://api.rating.chgk.net

Скорость работы скрипта зависит от доступности API и количества данных для анализа. Для больших турниров с большим количеством команд и игроков выполнение может занять значительное время.

## Дополнительная информация

Программа расшаривается AS IS. Для целей, в которых она пригождалась автору, её достаточно, остальное он не гарантирует. Если что-то идёт не так, пишите в [issues](https://github.com/a-berez/games_features/issues) или в личку. Или сразу можете [пуллреквестить](https://github.com/a-berez/games_features/pulls).

Лицензия — [MIT](https://github.com/a-berez/games_features/blob/main/LICENSE).  