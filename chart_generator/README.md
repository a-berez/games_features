# Генератор графиков взятий

Скрипт для генерации HTML-файлов с интерактивными графиками взятий вопросов и статистикой для турниров по КВРМ.

## Описание

Скрипт создает интерактивные графики, показывающие, как команды продвигались по дистанции турнира, а также кратко приводит дополнительную статистику:
- Гробы (вопросы, которые не взяла ни одна команда)
- Антигробы (вопросы, которые взяли все команды)
- Самые сложные вопросы (с указанием команд, которые их взяли)
- Самые легкие вопросы
- Снятые вопросы

## Примеры
- [СтудЧР 2025](https://nbviewer.org/github/a-berez/games_features/blob/main/chart_generator/examples/charts/12100/12100.html)

## Установка

### Зависимости

Для работы скрипта необходимы следующие библиотеки:
```
pip install pandas plotly requests openpyxl
```

## Использование

Скрипт можно запустить из командной строки следующим образом из директории, в которой он лежит:

```
chart_generator.py [ID_турнира_или_путь_к_файлу] [опциональные_аргументы]
```

### Способы ввода данных

Скрипт поддерживает три способа получения данных:

1. API турнирного сайта — укажите ID турнира:
```chart_generator.py 12100```


2. Табличный файл без разбиения на туры — укажите путь к CSV или XLSX файлу:
```chart_generator.py studchr_without_tours.xlsx```


3. Табличный файл с разбиением на туры — укажите путь к CSV или XLSX файлу с информацией о турах:
```chart_generator.py studchr_with_tours.xlsx```


### Форматы табличных файлов

> [!IMPORTANT]
> В данный момент скрипт поддерживает только подготовленные предварительно табличные файлы без пустых ячеек, пустых строк и повтров шапки.
> Примеры можно посмотреть в [папке](examples).

#### Формат без разбиения на туры
Файл должен содержать следующие столбцы:
1. ID команды
2. Название команды
3. Город
4. Вопрос (`1` = взят, `0` = не взят, `X` = снят)
5. ...

#### Формат с разбиением на туры
Файл должен содержать следующие столбцы:
1. ID команды
2. Название команды
3. Город
4. Номер тура
5. Вопрос тура (`1` = взят, `0` = не взят, `X` = снят)
6. ...

### Опциональные аргументы

- `-f`, `--flags` — список ID флагов для фильтрации команд (например: `4,5` или `4+5` или `4*7`) (только для данных с ТС)
- `-m`, `--more_files` — создание отдельных файлов для графиков флагов (yes/no, по умолчанию yes)
- `-n`, `--name` — название турнира
- `-o`, `--output` — имя выходного файла (без расширения)
- `-dev` — режим разработчика с подробным логированием


### Примеры использования


#### Базовое использование с API
```chart_generator.py 12345```


#### Использование с фильтрацией по флагу
```chart_generator.py 12345 -f 4```


#### Использование с комбинацией флагов (логическое ИЛИ)
```chart_generator.py 12345 -f 4+7```


#### Использование с комбинацией флагов (логическое И)
```chart_generator.py 12345 -f 4*7```


#### Использование с несколькими флагами
```chart_generator.py 12345 -f 4,7,4+7```


#### Использование с пользовательским именем турнира
```chart_generator.py 12345 -n "Первенство водокачки 2024"```


#### Использование с табличным файлом
```chart_generator.py tournament.xlsx```


#### Подробное логирование (режим разработчика)
```chart_generator.py 12345 -dev```


## Структура выходных файлов

Скрипт создает следующую структуру файлов:
```
charts/
├── ID_турнира_или_имя_файла/
│   ├── ID_турнира_или_имя_файла.html    # Основной файл с графиком
│   └── extra/                           # Дополнительные графики по флагам
│       ├── ID_турнира_или_имя_файла_4.html
│       ├── ID_турнира_или_имя_файла_4OR7.html
│       └── ...
```

## Интерпретация флагов

Для API-режима скрипт поддерживает фильтрацию команд по флагам:

- Одиночный флаг (например, `4`) — выбирает команды с указанным флагом
- Логическое ИЛИ (например, `4+7`) — выбирает команды с флагом 4 ИЛИ флагом 7
- Логическое И (например, `4*7`) — выбирает команды с флагом 4 И флагом 7
- Несколько фильтров (например, `4,7,4+7`) — создает отдельные графики для каждого фильтра

## Таблица флагов
Из таблицы убраны малоиспользуемые. Узнать все, можно, например, по [ссылке](https://api.rating.chgk.net/tournament_flags.json).  

| ID | Короткое название | Полное название |
|----:|------------------|-----------------|
| 3 | Школ | Школьная команда |
| 4 | С | Студенческая команда |
| 5 | Мол | Молодёжный зачёт (до 30 лет) |
| 6 | Вуз | Вузовская команда |
| 7 | S | Зачёт студенческого Чемпионата России |
| 37 | М | Средние школьники (8-9 классы) |
| 38 | Ш | Старшие школьники (10-11 классы) |
| 39 | Д | Младшие школьники (1-7 классы) |
| 44 | On | Online |
| 46 | Ind | Индивидуальный зачёт |
| 47 | Two | Парный зачёт |
| 48 | Плж | Пляжный зачёт |
| 49 | Free | Бесплатное участие |
| 50 | ЧСт | Зачет чемпионата страны |
| 51 | Взр | Взрослая команда |
| 54 | UAL | Украинский язык |
| 55 | UZL | Узбекский язык |
| 56 | ROL | Румынский язык |
| 57 | KZL | Казахский язык |
| 58 | BYL | Белорусский язык |
| 59 | ЧР | Выводящий зачёт ЧР |
| 60 | МлСт | Младшие студенты (U-20) |


## Примечания

- Флаги поддерживаются только при использовании API
- Если указаны флаги при использовании табличных файлов, они будут проигнорированы
- Снятые вопросы (отмеченные как `X`) учитываются в статистике, но не влияют на график взятий

## Дополнительная информация

Программа расшаривается AS IS. Для целей, в которых она пригождалась автору, её достаточно, остальное он не гарантирует. Если что-то идёт не так, пишите в [issues](https://github.com/a-berez/games_features/issues) или в личку. Или сразу можете [пуллреквестить](https://github.com/a-berez/games_features/pulls).

Лицензия — [MIT](https://github.com/a-berez/games_features/blob/main/LICENSE).  