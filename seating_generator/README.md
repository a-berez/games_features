# Генератор рассадки команд

Скрипт, который пытается создать оптимальную рассадку команд с учётом ограничений.  

## Описание

Это инструмент для организаторов игр в загадки, соревнований и других мероприятий, где требуется рассадить команды и/или индивидуальных участников в одном помещении таким образом, чтобы минимизировать нежелательное соседство.

Скрипт анализирует различные критерии (город, регион, номер команды и т. п.) и создаёт оптимальную рассадку, при которой команды с одинаковыми или похожими параметрами располагаются как можно дальше друг от друга.

### Основные возможности

- Загрузка списка команд с различными параметрами из Excel-файла
- Загрузка схемы рассадки с указанием доступных и недоступных мест
- Настройка приоритета критериев для оптимальной рассадки
- Учет «диагонального» соседства (команды, находящиеся по диагонали, тоже считаются соседями, но с меньшим весом)
- Специальная обработка числовых параметров (например, номеров команд)
- Генерация нескольких вариантов рассадки с минимальными «штрафами»
- Сохранение результатов в Excel-файлы

## Требования

- Python 3.6 или выше
- Библиотеки:
  - pandas
  - numpy

### Установка зависимостей
```
pip install pandas numpy
```
Или с помощью [requirements.txt](requirements.txt):  
```
pip install -r путь_к_файлу/requirements.txt
```

## Использование

### Базовое использование
```
python seating_generator.py -i путь_к_файлу_команд.xlsx -s путь_к_схеме_рассадки.xlsx
```

Если запустить скрипт без параметров, он запросит пути к файлам интерактивно:
```
python seating_generator.py
```

### Параметры командной строки

- `-i`, `--input`: Путь к Excel-файлу со списком команд
- `-s`, `--seating`: Путь к Excel-файлу со схемой рассадки
- `-abc`, `--alphabetical_order`: Игнорировать номера при рассадке (полезно, если номера не отражают рейтинг команд)
- `-o`, `--order`: Порядок важности столбцов (например, `2,4,1,3` — порядок столбцов в порядке убывания важности)

### Формат входных данных

#### Файл со списком команд (Excel)

Должен содержать следующие столбцы:
- `team` (обязательный): Название команды
- Другие столбцы (не более 5): Критерии для рассадки (город, регион, номер и т. д.). Столбец с номером всегда должен называться `number`, столбец с дополнительными параметрами, которые есть только у нескольких команд — `extra`  

Порядок столбцов слева направо соответствует важности критерия при рассадке. Например, если столбцы идут в порядке team, town, region, number, то при рассадке в первую очередь будут учитываться города команд, затем регионы, и только потом номера.

Специальные столбцы:
- `number`: Если присутствует, обрабатывается особым образом — команды с близкими номерами получают более высокий штраф за соседство
- `extra`: Если присутствует, учитывает дополнительные ограничения — команды с одинаковыми значениями в этом столбце не должны сидеть рядом

#### Файл со схемой рассадки (Excel)

Содержит схему помещения, где:
- `X`: доступное место для размещения команды
- `O`: недоступное место (проходы, технические зоны и т.д.)

Пример схемы рассадки для помещения с 4 рядами по 4 стола:
```
XXXX
XXXX
XXXX
XXXX
```

### Выходные данные

Скрипт генерирует следующие файлы:

- `seating.xlsx`: Лучший вариант рассадки
- `seating_1.xlsx`, `seating_2.xlsx`: Альтернативные варианты рассадки (если доступны)

В выходных файлах места, где размещены команды, содержат их названия, а недоступные места помечены как `НЕДОСТУПНО`.

## Алгоритм работы

1. Загрузка данных:
   - Загрузка списка команд и их параметров
   - Загрузка схемы рассадки
   - Проверка на достаточность мест

2. Определение порядка важности критериев:
   - Анализ столбцов во входном файле
   - Запрос подтверждения или изменения порядка у пользователя

3. Генерация начальных вариантов рассадки:
   - Создание нескольких случайных размещений команд
   - Оценка качества каждого размещения (расчет штрафов)
   - Выбор лучших вариантов для дальнейшей оптимизации

4. Оптимизация рассадки:
   - Перебор различных перестановок команд
   - Оценка каждой перестановки по системе штрафов
   - Сохранение перестановок, улучшающих рассадку
   - Повторение процесса до достижения локального оптимума

5. Сохранение результатов:
   - Сохранение лучшего варианта рассадки
   - Сохранение альтернативных вариантов (до 3-х в общей сложности)

## Примеры

В папке [examples](examples) находятся примеры входных файлов:

- `teams.xlsx`: Пример файла со списком команд
- `places.xlsx`: Пример файла со схемой рассадки

### Пример запуска
```
python seating_generator.py -i examples/teams.xlsx -s examples/places.xlsx
```

### Пример с изменением порядка важности критериев
```
python seating_generator.py -i examples/teams.xlsx -s examples/places.xlsx -o "3,1,2,4"
```

### Пример с игнорированием номеров команд
```
python seating_generator.py -i examples/teams.xlsx -s examples/places.xlsx -abc
```

## Советы по использованию

- Схема рассадки: При создании схемы рассадки учитывайте не только физические ограничения помещения, но и желаемую плотность размещения команд.

- Номера команд: Если номера команд **не** отражают их рейтинг или результаты предыдущих этапов, лучше использовать `-abc`, поскольку номер не будет значимым показателем для рассадки.

- Альтернативные варианты: Просмотрите все сгенерированные варианты рассадки, иногда второй или третий вариант может лучше соответствовать дополнительным критериям, не учтенным в скрипте.

## Дополнительная информация

Программа расшаривается AS IS. Для целей, в которых она пригождалась автору, её достаточно, остальное он не гарантирует. Если что-то идёт не так, пишите в [issues](https://github.com/a-berez/games_features/issues) или в личку. Или сразу можете [пуллреквестить](https://github.com/a-berez/games_features/pulls).

Лицензия — [MIT](https://github.com/a-berez/games_features/blob/main/LICENSE).  
